(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[994],{755:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});var s=(0,t(86467).A)("outline","plus","IconPlus",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M5 12l14 0",key:"svg-1"}]])},30285:(e,r,t)=>{"use strict";t.d(r,{$:()=>c});var s=t(95155),a=t(12115),l=t(99708),o=t(74466),i=t(59434);let n=(0,o.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,r)=>{let{className:t,variant:a,size:o,asChild:c=!1,...d}=e,u=c?l.DX:"button";return(0,s.jsx)(u,{className:(0,i.cn)(n({variant:a,size:o,className:t})),ref:r,...d})});c.displayName="Button"},33273:(e,r,t)=>{"use strict";t.d(r,{default:()=>b});var s=t(95155),a=t(12115),l=t(5041),o=t(6942),i=t(38280),n=t(54395),c=t(26884),d=t(755),u=t(18999),m=t(74634),g=t(59434);let p=a.forwardRef((e,r)=>{let{className:t,type:a,...l}=e;return(0,s.jsx)("input",{type:a,className:(0,g.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:r,...l})});p.displayName="Input";var f=t(30285),h=t(85057);let x=async e=>{let r=new FormData;r.append("title",e.title),r.append("composer",e.composer||"Anonymous"),r.append("lyrics",e.lyrics),e.file&&r.append("pdf_file",e.file),e.year&&r.append("year",e.year.toString()),r.append("categories",JSON.stringify(e.categories.map(e=>({name:e})))),r.append("analyze","false");let t=await fetch("http://127.0.0.1:8000/api/upload/",{method:"POST",body:r});if(!t.ok)throw Error((await t.json()).message||"Failed to upload file");return t.json()};function b(){var e;let[r,t]=(0,a.useState)([]),[g,b]=(0,a.useState)([]),[v,y]=(0,a.useState)(""),[j,N]=(0,a.useState)(!1),[w,k]=(0,a.useState)({title:"",composer:"",lyrics:"",file:null,categories:[],year:null}),A=(0,u.useRouter)();(0,a.useEffect)(()=>{(async()=>{try{let e=await fetch("https://nota-db.onrender.com/api/categories/");if(!e.ok)throw Error("Failed to fetch categories");let r=await e.json();b(r)}catch(e){console.error("Error fetching categories:",e)}})()},[]);let{mutate:C,isPending:S,error:_}=(0,l.n)({mutationFn:x,onSuccess:e=>{o.$e.show({title:"Success",message:e.message||"File uploaded successfully",color:"green",icon:(0,s.jsx)(i.A,{}),position:"top-center"}),k({title:"",composer:"",lyrics:"",file:null,categories:[],year:null}),t([]),A.push("/library")},onError:e=>{o.$e.show({title:"Error",message:e.message,color:"red",icon:(0,s.jsx)(n.A,{}),position:"top-center"})}}),F=e=>{let{name:r,value:t}=e.target;k(e=>({...e,[r]:"year"===r?t?Number(t):null:t}))},z=e=>{let r=e.filter(e=>"application/pdf"===e.type);if(r.length!==e.length){o.$e.show({title:"Error",message:"Only PDF files can be uploaded.",color:"red",icon:(0,s.jsx)(n.A,{})});return}t([r[0]]),k(e=>({...e,file:r[0]}))},E=e=>{k(r=>{let t=r.categories.includes(e)?r.categories.filter(r=>r!==e):[...r.categories,e];return{...r,categories:t}})},D=Array.from({length:new Date().getFullYear()-1900+1},(e,r)=>1900+r);return(0,s.jsxs)("div",{className:"max-w-3xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-orange-600 mb-2",children:"Upload New Music Score"}),(0,s.jsx)("h4",{className:"text-gray-600",children:"Share your musical masterpiece with the world!"})]}),(0,s.jsx)("form",{onSubmit:e=>{e.preventDefault(),w.file&&w.title.trim()&&C(w)},className:"space-y-6",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(h.J,{htmlFor:"title",children:"Title"}),(0,s.jsx)(p,{name:"title",value:w.title,onChange:F,placeholder:"Title",required:!0}),(0,s.jsx)(h.J,{htmlFor:"composer",children:"Composer"}),(0,s.jsx)(p,{name:"composer",value:w.composer,onChange:F,placeholder:"Composer"}),(0,s.jsx)(h.J,{htmlFor:"year",children:"Year Composed"}),(0,s.jsxs)("select",{name:"year",value:(null===(e=w.year)||void 0===e?void 0:e.toString())||"",onChange:F,className:"w-full p-3 bg-white border rounded-md border-orange-200 focus:border-orange-500 focus:ring-2 focus:ring-orange-500 focus:outline-none",children:[(0,s.jsx)("option",{value:"",children:"Select Year"}),D.reverse().map(e=>(0,s.jsx)("option",{value:e,children:e},e))]}),(0,s.jsx)(h.J,{htmlFor:"lyrics",children:"Lyrics"}),(0,s.jsx)("textarea",{name:"lyrics",value:w.lyrics,onChange:F,placeholder:"Lyrics?",rows:3,className:"w-full p-3 border rounded-md border-orange-200 focus:border-orange-500 focus:ring-2 focus:ring-orange-500 focus:outline-none"}),(0,s.jsx)("div",{className:"border-2 border-dashed rounded-lg p-6 cursor-pointer\n              ".concat(r.length?"border-orange-500 bg-orange-50":"border-gray-300","\n              ").concat(_?"border-red-500 bg-red-50":"","\n              hover:border-orange-500 transition-colors"),onDrop:e=>{e.preventDefault(),z(Array.from(e.dataTransfer.files))},onDragOver:e=>e.preventDefault(),onClick:()=>{let e=document.createElement("input");e.type="file",e.accept="application/pdf",e.onchange=e=>{let r=e.target;r.files&&z(Array.from(r.files))},e.click()},children:(0,s.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[r.length?(0,s.jsx)(c.A,{size:52,className:"text-orange-500"}):(0,s.jsx)(i.A,{size:52,className:"text-gray-400"}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-xl",children:r.length?"".concat(r.length," file selected"):"Drag a PDF file here or click to select"}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Maximum file size: 5MB"})]})]})}),r.length>0&&(0,s.jsx)("div",{className:"space-y-2",children:r.map((e,r)=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-orange-50 rounded-md",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600",children:e.name}),(0,s.jsx)(f.$,{variant:"ghost",size:"sm",onClick:()=>{t([]),k(e=>({...e,file:null}))},children:(0,s.jsx)(n.A,{size:20})})]},r))}),(0,s.jsx)(h.J,{children:"Categories"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:g.map(e=>(0,s.jsx)(f.$,{type:"button",variant:w.categories.includes(e.name)?"default":"outline",onClick:()=>E(e.name),children:e.name},e.id))}),j?(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(p,{value:v,onChange:e=>y(e.target.value),placeholder:"Enter new category"}),(0,s.jsx)(f.$,{type:"button",onClick:()=>{v.trim()&&(k(e=>({...e,categories:[...e.categories,v.trim()]})),y(""),N(!1))},children:"Add"})]}):(0,s.jsxs)(f.$,{type:"button",variant:"link",onClick:()=>N(!0),className:"flex items-center gap-2 text-orange-600",children:[(0,s.jsx)(d.A,{size:16})," Add New Category"]}),w.categories.length>0&&(0,s.jsxs)("div",{className:"mt-2",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"Selected categories:"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:w.categories.map(e=>(0,s.jsxs)("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-sm",children:[e,(0,s.jsx)(f.$,{variant:"ghost",size:"sm",onClick:()=>E(e),children:(0,s.jsx)(n.A,{size:14})})]},e))})]}),_&&(0,s.jsx)(m.Alert,{color:"red",title:"Error",children:_}),(0,s.jsx)(f.$,{type:"submit",disabled:S||!w.file||!w.title.trim(),className:"w-full",children:S?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-white mr-2"}),"Uploading..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.A,{size:20,className:"mr-2"})," Upload"]})})]})})]})}},59434:(e,r,t)=>{"use strict";t.d(r,{cn:()=>l});var s=t(52596),a=t(39688);function l(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,a.QP)((0,s.$)(r))}},74634:(e,r,t)=>{"use strict";t.d(r,{Alert:()=>f});var s=t(95155),a=t(64173);t(12115);var l=t(56204),o=t(68918),i=t(43664),n=t(53791),c=t(69604),d=t(36960),u=t(95642),m={root:"m_66836ed3",wrapper:"m_a5d60502",body:"m_667c2793",title:"m_6a03f287",label:"m_698f4f23",icon:"m_667f2a6a",message:"m_7fa78076",closeButton:"m_87f54839"};let g={},p=(0,o.createVarsResolver)((e,r)=>{let{radius:t,color:s,variant:a,autoContrast:o}=r,i=e.variantColorResolver({color:s||e.primaryColor,theme:e,variant:a||"light",autoContrast:o});return{root:{"--alert-radius":void 0===t?void 0:(0,l.getRadius)(t),"--alert-bg":s||a?i.background:void 0,"--alert-color":i.color,"--alert-bd":s||a?i.border:void 0}}}),f=(0,d.factory)((e,r)=>{let t=(0,i.useProps)("Alert",g,e),{classNames:l,className:o,style:d,styles:f,unstyled:h,vars:x,radius:b,color:v,title:y,children:j,id:N,icon:w,withCloseButton:k,onClose:A,closeButtonLabel:C,variant:S,autoContrast:_,...F}=t,z=(0,n.useStyles)({name:"Alert",classes:m,props:t,className:o,style:d,classNames:l,styles:f,unstyled:h,vars:x,varsResolver:p}),E=(0,a.useId)(N),D=y&&"".concat(E,"-title")||void 0,$="".concat(E,"-body");return(0,s.jsx)(c.Box,{id:E,...z("root",{variant:S}),variant:S,ref:r,...F,role:"alert","aria-describedby":$,"aria-labelledby":D,children:(0,s.jsxs)("div",{...z("wrapper"),children:[w&&(0,s.jsx)("div",{...z("icon"),children:w}),(0,s.jsxs)("div",{...z("body"),children:[y&&(0,s.jsx)("div",{...z("title"),"data-with-close-button":k||void 0,children:(0,s.jsx)("span",{id:D,...z("label"),children:y})}),j&&(0,s.jsx)("div",{id:$,...z("message"),"data-variant":S,children:j})]}),k&&(0,s.jsx)(u.CloseButton,{...z("closeButton"),onClick:A,variant:"transparent",size:16,iconSize:16,"aria-label":C,unstyled:h})]})})});f.classes=m,f.displayName="@mantine/core/Alert"},78100:(e,r,t)=>{Promise.resolve().then(t.bind(t,33273))},85057:(e,r,t)=>{"use strict";t.d(r,{J:()=>c});var s=t(95155),a=t(12115),l=t(40968),o=t(74466),i=t(59434);let n=(0,o.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=a.forwardRef((e,r)=>{let{className:t,...a}=e;return(0,s.jsx)(l.b,{ref:r,className:(0,i.cn)(n(),t),...a})});c.displayName=l.b.displayName}},e=>{var r=r=>e(e.s=r);e.O(0,[886,433,724,441,684,358],()=>r(78100)),_N_E=e.O()}]);