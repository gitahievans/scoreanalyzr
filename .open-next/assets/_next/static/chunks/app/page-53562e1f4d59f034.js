(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{30285:(e,s,r)=>{"use strict";r.d(s,{$:()=>c});var t=r(95155),a=r(12115),l=r(99708),n=r(74466),i=r(59434);let o=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,s)=>{let{className:r,variant:a,size:n,asChild:c=!1,...d}=e,u=c?l.DX:"button";return(0,t.jsx)(u,{className:(0,i.cn)(o({variant:a,size:n,className:r})),ref:s,...d})});c.displayName="Button"},59434:(e,s,r)=>{"use strict";r.d(s,{cn:()=>l});var t=r(52596),a=r(39688);function l(){for(var e=arguments.length,s=Array(e),r=0;r<e;r++)s[r]=arguments[r];return(0,a.QP)((0,t.$)(s))}},85057:(e,s,r)=>{"use strict";r.d(s,{J:()=>c});var t=r(95155),a=r(12115),l=r(40968),n=r(74466),i=r(59434);let o=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)(l.b,{ref:s,className:(0,i.cn)(o(),r),...a})});c.displayName=l.b.displayName},91540:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>W});var t=r(95155),a=r(12115),l=r(5041),n=r(85057),i=r(38280),o=r(54395),c=r(26884),d=r(6942),u=r(30285);let m=async e=>{let s=new FormData;e.pdf_file&&(s.append("pdf_file",e.pdf_file),s.append("title",e.pdf_file.name||"Untitled Score"),s.append("composer","Anonymous"),s.append("analyze","true"));let r=await fetch("".concat("https://api.notadb.xyz:8443","/api/upload/"),{method:"POST",body:s});if(!r.ok)throw Error((await r.json()).message||"Failed to upload file");return r.json()};function x(e){let{onUploadSuccess:s,isProcessing:r}=e,[x,h]=(0,a.useState)([]),[f,g]=(0,a.useState)(null),{mutate:p,isPending:v}=(0,l.n)({mutationFn:m,onSuccess:e=>{d.$e.show({title:"Success",message:e.message||"File uploaded successfully",color:"green",icon:(0,t.jsx)(i.A,{}),position:"top-center"}),h([]),g(null),s(e.score_id,e.task_id)},onError:e=>{g(e.message),d.$e.show({title:"Error",message:e.message,color:"red",icon:(0,t.jsx)(o.A,{}),position:"top-center"})}}),b=e=>"application/pdf"!==e.type?(g("Only PDF files are allowed"),!1):!(e.size>5242880)||(g("File size exceeds 5MB limit"),!1),j=(0,a.useCallback)(e=>{if(r)return;g(null);let s=e.filter(b);s.length>0&&h([s[0]])},[r]);return(0,t.jsx)("div",{children:(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),!r&&x[0]&&p({pdf_file:x[0]})},children:[(0,t.jsx)(n.J,{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Upload PDF Music Score"}),(0,t.jsx)("div",{className:"border-2 border-dashed rounded-lg p-6 cursor-pointer\n            ".concat(x.length?"border-orange-500 bg-orange-50":"border-gray-300","\n            ").concat(f?"border-red-500 bg-red-50":"","\n            ").concat(r?"opacity-50 cursor-not-allowed":"hover:border-orange-500","\n            transition-colors"),onDrop:e=>{e.preventDefault(),r||j(Array.from(e.dataTransfer.files))},onDragOver:e=>e.preventDefault(),onClick:()=>{if(r)return;let e=document.createElement("input");e.type="file",e.accept=".pdf",e.onchange=e=>{let s=e.target;s.files&&j(Array.from(s.files))},e.click()},children:(0,t.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[x.length?(0,t.jsx)(c.A,{size:52,className:"text-orange-500"}):(0,t.jsx)(i.A,{size:52,className:"text-gray-400"}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-xl",children:x.length?"".concat(x.length," file selected"):"Drag a PDF file here or click to select"}),(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Maximum file size: 5MB"}),f&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-2",children:f})]})]})}),x.length>0&&(0,t.jsx)("div",{className:"space-y-4 mt-4",children:x.map((e,s)=>(0,t.jsx)("div",{className:"bg-orange-50 rounded-md overflow-hidden border border-orange-200",children:(0,t.jsxs)("div",{className:"flex items-center justify-between p-3",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(c.A,{size:24,className:"text-orange-500"}),(0,t.jsx)("span",{className:"text-sm text-gray-600",children:e.name})]}),(0,t.jsx)(u.$,{variant:"ghost",size:"sm",onClick:()=>{h([]),g(null)},disabled:r,children:(0,t.jsx)(o.A,{size:20})})]})},s))}),(0,t.jsx)(u.$,{type:"submit",disabled:v||!x.length||r,className:"mt-4 bg-orange-500 hover:bg-orange-600 text-white",children:v?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Uploading..."]}):"Upload Score"})]})})}var h=r(59434);let f=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("div",{ref:s,className:(0,h.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...a})});f.displayName="Card";let g=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("div",{ref:s,className:(0,h.cn)("flex flex-col space-y-1.5 p-6",r),...a})});g.displayName="CardHeader";let p=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("div",{ref:s,className:(0,h.cn)("text-2xl font-semibold leading-none tracking-tight",r),...a})});p.displayName="CardTitle",a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("div",{ref:s,className:(0,h.cn)("text-sm text-muted-foreground",r),...a})}).displayName="CardDescription";let v=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("div",{ref:s,className:(0,h.cn)("p-6 pt-0",r),...a})});v.displayName="CardContent",a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("div",{ref:s,className:(0,h.cn)("flex items-center p-6 pt-0",r),...a})}).displayName="CardFooter";var b=r(32960);let j=(0,a.createContext)(void 0),N="https://api.notadb.xyz:8443";console.log("API_URL_FROM_CONTEXT:",N);let y=async(e,s)=>{let r=await fetch("".concat(N,"/api/scores/").concat(e,"/?task_id=").concat(s));if(!r.ok)throw Error((await r.json()).message||"Failed to fetch score");let t=await r.json();return console.log("Parsed Score data from Context:",t),t},w=e=>{let{scoreId:s,taskId:r,children:a}=e,{data:l,error:n,isLoading:i,refetch:o}=(0,b.I)({queryKey:["score",s,r],queryFn:()=>y(s,r),enabled:!!s&&!!r,refetchInterval:e=>{var s,r;let t=e.state.data;return!!t&&(null==t?void 0:null===(s=t.task_status)||void 0===s?void 0:s.state)==="PENDING"&&(null==t||null===(r=t.score)||void 0===r||!r.processed)&&3e3},retry:(e,s)=>!(e>=3)});return(0,t.jsx)(j.Provider,{value:{scoreData:l,isLoading:i,error:n,refetch:o},children:a})},k=()=>{let e=(0,a.useContext)(j);if(void 0===e)throw Error("useScoreData must be used within a ScoreDataProvider");return e};var S=r(16809);let A=S.bL,M=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)(S.B8,{ref:s,className:(0,h.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...a})});M.displayName=S.B8.displayName;let C=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)(S.l9,{ref:s,className:(0,h.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",r),...a})});C.displayName=S.l9.displayName;let R=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)(S.UC,{ref:s,className:(0,h.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...a})});R.displayName=S.UC.displayName;let E=(0,r(74466).F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),_=a.forwardRef((e,s)=>{let{className:r,variant:a,...l}=e;return(0,t.jsx)("div",{ref:s,role:"alert",className:(0,h.cn)(E({variant:a}),r),...l})});_.displayName="Alert",a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("h5",{ref:s,className:(0,h.cn)("mb-1 font-medium leading-none tracking-tight",r),...a})}).displayName="AlertTitle";let D=a.forwardRef((e,s)=>{let{className:r,...a}=e;return(0,t.jsx)("div",{ref:s,className:(0,h.cn)("text-sm [&_p]:leading-relaxed",r),...a})});D.displayName="AlertDescription";var F=r(52655);let L=()=>(0,t.jsxs)("div",{className:"flex items-center justify-center p-8",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),(0,t.jsx)("span",{className:"ml-3 text-gray-600",children:"Loading sheet music..."})]}),P=e=>{let{message:s}=e;return(0,t.jsx)("div",{className:"flex items-center justify-center p-8 bg-red-50 border border-red-200 rounded-lg",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-red-600 text-lg font-semibold mb-2",children:"Error Loading Sheet Music"}),(0,t.jsx)("div",{className:"text-red-500 text-sm",children:s})]})})},T=e=>{let{musicXML:s,width:r,height:l,showLoadingSpinner:n=!0,className:i="",onLoad:o,onError:c,renderingOptions:d={}}=e,u=(0,a.useRef)(null),m=(0,a.useRef)(null),[x,h]=(0,a.useState)(!1),[f,g]=(0,a.useState)(null),p=(0,a.useCallback)(async()=>{if(u.current&&s){h(!0),g(null);try{var e,r,t;u.current.innerHTML="",m.current=new F.OpenSheetMusicDisplay(u.current,{autoResize:!0,backend:"svg",drawTitle:null===(e=d.drawTitle)||void 0===e||e,drawComposer:null===(r=d.drawComposer)||void 0===r||r,drawFingerings:null!==(t=d.drawFingerings)&&void 0!==t&&t,drawCredits:!1,drawPartNames:!0,followCursor:!1,defaultColorMusic:"#1f1f1f",pageFormat:d.pageFormat||"A4_P"}),await m.current.load(s),m.current.render(),console.log("MusicXML rendered successfully"),h(!1),null==o||o()}catch(s){let e=s instanceof Error?s.message:"Unknown error occurred";console.error("Error loading MusicXML:",s),g(e),h(!1),null==c||c(e)}}},[s,d,o,c]);return(0,a.useEffect)(()=>{s&&u.current&&p()},[s,p]),(0,a.useEffect)(()=>()=>{if(m.current){try{m.current.clear()}catch(e){console.warn("Error during OSMD cleanup:",e)}m.current=null}},[]),(0,t.jsxs)("div",{className:"osmd-wrapper ".concat(i),children:[x&&n&&(0,t.jsx)(L,{}),f&&(0,t.jsx)(P,{message:f}),(0,t.jsx)("div",{ref:u,className:"osmd-container p-6 min-h-[400px] overflow-auto",style:{width:r?"".concat(r,"px"):"100%",height:l?"".concat(l,"px"):"auto",display:x||f?"none":"block"}}),!1]})};var z=r(98921),I=r(4582),U=r(9255),O=r(45554),X=r(74601);let $="https://api.notadb.xyz:8443",G=e=>e.split("\n\n").map((e,s)=>e.trim()?(0,t.jsx)("p",{className:"mb-4 text-gray-700 leading-relaxed",children:(e=>{let s;let r=[],a=0,l=/(\*\*\*[^*]+\*\*\*|\*\*[^*]+\*\*|\*[^*]+\*)/g;for(;null!==(s=l.exec(e));){s.index>a&&r.push(e.slice(a,s.index));let l=s[0],n=l.replace(/\*/g,"");l.startsWith("***")?r.push((0,t.jsx)("strong",{className:"font-bold text-gray-900",children:n},"bold-".concat(s.index))):l.startsWith("**")?r.push((0,t.jsx)("strong",{className:"font-semibold text-gray-800",children:n},"bold-".concat(s.index))):l.startsWith("*")&&r.push((0,t.jsx)("em",{className:"italic text-gray-700",children:n},"italic-".concat(s.index))),a=s.index+l.length}return a<e.length&&r.push(e.slice(a)),r.length>0?r:[e]})(e)},s):null).filter(Boolean);function B(e){var s,r,l,n,i,o,c,d,m,x;let{onProcessingChange:h}=e,{scoreData:b,isLoading:j,error:N,refetch:y}=k(),[w,S]=(0,a.useState)(!1),[E,F]=(0,a.useState)(null),[L]=(0,a.useState)({drawTitle:!0,drawComposer:!0,drawFingerings:!1}),[P,B]=(0,a.useState)(null),[W,H]=(0,a.useState)(0),[V,J]=(0,a.useState)(null),[q,K]=(0,a.useState)(!1),[Y,Q]=(0,a.useState)(null);console.log("ScoreData from context:",b),(0,a.useEffect)(()=>{var e,s,r;(null==b?void 0:null===(e=b.score)||void 0===e?void 0:e.processed)||(null==b?void 0:null===(s=b.task_status)||void 0===s?void 0:s.state)==="FAILURE"?h(!1):((null==b?void 0:null===(r=b.task_status)||void 0===r?void 0:r.state)==="PENDING"||j)&&h(!0)},[b,j,h]),(0,a.useEffect)(()=>{var e,s;(null==b?void 0:null===(e=b.score)||void 0===e?void 0:e.processed)&&(null==b?void 0:null===(s=b.task_status)||void 0===s?void 0:s.state)!=="PENDING"&&(async()=>{try{var e,s;console.log("Attempting to fetch MusicXML from:","".concat($).concat(null==b?void 0:null===(e=b.score)||void 0===e?void 0:e.musicxml_url));let r=await fetch("".concat($).concat(null==b?void 0:null===(s=b.score)||void 0===s?void 0:s.musicxml_url),{method:"GET",headers:{Accept:"application/xml, text/xml, application/vnd.recordare.musicxml+xml, */*"}});if(!r.ok)throw Error("HTTP error! status: ".concat(r.status," - ").concat(r.statusText));let t=r.headers.get("content-type");console.log("Response content type:",t);let a=await r.text();if(console.log("Response length:",a.length),console.log("First 200 characters:",a.substring(0,200)),!a.trim().startsWith("<?xml")&&!a.trim().startsWith("<"))throw Error("Response is not valid XML format");a.includes("score-partwise")||a.includes("score-timewise")||console.warn("Warning: Content doesn't appear to be MusicXML format"),B(a),F(null),H(0),console.log("MusicXML fetched successfully")}catch(s){let e=s instanceof Error?s.message:"Unknown error";if(console.error("Failed to fetch MusicXML:",e),W<3&&(e.includes("network")||e.includes("timeout"))){console.log("Retrying fetch attempt ".concat(W+1,"/3")),H(e=>e+1),setTimeout(()=>{},2e3*(W+1));return}F("Failed to fetch MusicXML: ".concat(e)),B(null),H(0)}})()},[null==b?void 0:null===(s=b.score)||void 0===s?void 0:s.processed,null==b?void 0:null===(r=b.task_status)||void 0===r?void 0:r.state,W]);let Z=async()=>{var e;if(!(null==b?void 0:null===(e=b.score)||void 0===e?void 0:e.id)){Q("No score ID available for summary generation");return}K(!0),Q(null);try{let e=await fetch("".concat($,"/api/generate-summary/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({score_id:b.score.id})});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let s=await e.json();if("success"===s.status&&s.summary)J(s.summary);else throw Error("Invalid response format from server")}catch(e){Q(e instanceof Error?e.message:"Failed to generate summary")}finally{K(!1)}};return N?(0,t.jsxs)("div",{className:"space-y-6 p-4",children:[(0,t.jsxs)("h2",{className:"text-2xl font-bold text-orange-600 flex items-center gap-2",children:[(0,t.jsx)(z.A,{className:"h-6 w-6"})," Score Analysis Results"]}),(0,t.jsxs)(f,{children:[(0,t.jsx)(g,{children:(0,t.jsx)(p,{children:"Error"})}),(0,t.jsxs)(v,{children:[(0,t.jsx)("p",{children:N.message}),(0,t.jsx)(u.$,{className:"mt-4",onClick:()=>y(),children:"Retry"})]})]})]}):j||b||N?(0,t.jsxs)("div",{className:"space-y-6 p-4",children:[(0,t.jsxs)("h2",{className:"text-2xl font-bold text-orange-600 flex items-center gap-2",children:[(0,t.jsx)(z.A,{className:"h-6 w-6"})," Score Analysis Results"]}),j||b&&!(null===(l=b.score)||void 0===l?void 0:l.processed)&&(null===(n=b.task_status)||void 0===n?void 0:n.state)==="PENDING"?(0,t.jsx)(f,{children:(0,t.jsxs)(v,{className:"flex items-center justify-center p-6",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500 mr-2"}),(0,t.jsx)("p",{children:(null==b?void 0:null===(i=b.task_status)||void 0===i?void 0:i.info)||"Let the magic unfold, it might take a while..."})]})}):(0,t.jsxs)(A,{defaultValue:"results",className:"w-full",children:[(0,t.jsxs)(M,{className:"grid w-full grid-cols-3",children:[(0,t.jsx)(C,{value:"results",children:"Analysis Results"}),(0,t.jsx)(C,{value:"musicxml",children:"Sheet Music"}),(0,t.jsx)(C,{value:"summary",children:"AI Summary"})]}),(0,t.jsx)(R,{value:"results",children:(0,t.jsxs)(f,{children:[(0,t.jsx)(g,{children:(0,t.jsx)(p,{children:(null==b?void 0:null===(o=b.score)||void 0===o?void 0:o.title)||"No title"})}),(0,t.jsx)(v,{children:(null==b?void 0:null===(c=b.score)||void 0===c?void 0:c.results)?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-lg border border-blue-200",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-blue-600 mb-1",children:"Key Signature"}),(0,t.jsx)("div",{className:"text-lg font-bold text-blue-900",children:b.score.results.key})]}),(0,t.jsxs)("div",{className:"bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-lg border border-green-200",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-green-600 mb-1",children:"Time Signature"}),(0,t.jsx)("div",{className:"text-lg font-bold text-green-900",children:b.score.results.time_signature})]}),(0,t.jsxs)("div",{className:"bg-gradient-to-br from-amber-50 to-amber-100 p-4 rounded-lg border border-amber-200",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-amber-600 mb-1",children:"Parts"}),(0,t.jsx)("div",{className:"text-sm font-semibold text-amber-900",children:null===(d=b.score.results.parts)||void 0===d?void 0:d.join(", ")})]}),(0,t.jsxs)("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 p-4 rounded-lg border border-purple-200",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-purple-600 mb-1",children:"MusicXML"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(I.A,{className:"h-4 w-4 text-purple-700"}),(0,t.jsx)("span",{className:"text-sm font-semibold text-purple-900",children:P?"Available":"Not Available"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"A few chords detected"})}),b.score.results.chords&&b.score.results.chords.length>0?(0,t.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg border",children:(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:b.score.results.chords.map((e,s)=>(0,t.jsxs)("div",{className:"inline-flex items-center px-3 py-2 rounded-md text-sm font-medium transition-colors ".concat("Chord Symbol Cannot Be Identified"===e.pitch?"bg-red-100 text-red-700 border border-red-200":"bg-blue-100 text-blue-700 border border-blue-200 hover:bg-blue-200"),children:[(0,t.jsx)("span",{className:"font-semibold",children:e.pitch}),(0,t.jsxs)("span",{className:"ml-2 text-xs opacity-75",children:["@",e.offset]})]},s))})}):(0,t.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg border text-center text-gray-500",children:"No chord progression detected"})]})]}):(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"text-gray-400 mb-2",children:(0,t.jsx)(z.A,{className:"h-12 w-12 mx-auto"})}),(0,t.jsx)("p",{className:"text-gray-500",children:"No analysis results available for this score."})]})})]})}),(0,t.jsx)(R,{value:"musicxml",children:(0,t.jsxs)(f,{children:[(0,t.jsxs)(g,{children:[(0,t.jsxs)(p,{className:"flex items-center gap-2",children:[(0,t.jsx)(I.A,{className:"h-5 w-5"}),"Sheet Music Viewer"]}),P&&(0,t.jsxs)("div",{className:"text-sm text-gray-500",children:["Rendered from: ",(null==b?void 0:null===(m=b.score)||void 0===m?void 0:m.title)||"Untitled Score"]})]}),(0,t.jsx)(v,{children:P?(0,t.jsxs)("div",{className:"space-y-4",children:[E&&(0,t.jsx)(_,{variant:"destructive",children:(0,t.jsxs)(D,{children:["Failed to load sheet music: ",E]})}),E&&(0,t.jsx)(_,{className:"mb-4",children:(0,t.jsx)(D,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{children:["Error loading sheet music: ",E]}),(0,t.jsx)(u.$,{variant:"outline",size:"sm",onClick:()=>{H(0),F(null),B(null),y()},className:"ml-4",children:"Retry"})]})})}),w&&!E&&(0,t.jsx)(_,{children:(0,t.jsx)(D,{className:"text-green-700",children:"Sheet music loaded successfully! You can scroll and zoom to explore the notation."})}),(0,t.jsx)("div",{className:"w-full min-h-[600px] bg-white rounded-lg border border-gray-200",children:(0,t.jsx)(T,{musicXML:P,showLoadingSpinner:!0,onLoad:()=>{console.log("MusicXML loaded successfully in OSMD"),S(!0),F(null)},onError:e=>{console.error("OSMD Error:",e),F(e),S(!1)},renderingOptions:L,className:"w-full h-full",height:600})}),(0,t.jsxs)("div",{className:"flex justify-between items-center text-sm text-gray-500",children:[(0,t.jsx)("div",{children:"Use mouse wheel to zoom, click and drag to pan"}),(0,t.jsx)("div",{className:"flex gap-2",children:(0,t.jsx)(u.$,{variant:"outline",size:"sm",onClick:()=>{let e=new Blob([P],{type:"application/xml"}),s=URL.createObjectURL(e),r=document.createElement("a");r.href=s,r.download="score.musicxml",r.click(),URL.revokeObjectURL(s)},children:"Download MusicXML"})})]})]}):(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("div",{className:"text-gray-400 mb-4",children:(0,t.jsx)(I.A,{className:"h-16 w-16 mx-auto"})}),(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No MusicXML Available"}),(0,t.jsx)("p",{className:"text-gray-500 max-w-md mx-auto",children:"The sheet music notation is not available for this score. This could happen if the analysis is still processing or if the original image couldn't be converted to MusicXML format."}),(null==b?void 0:b.score)&&!b.score.processed&&(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsxs)(u.$,{variant:"outline",onClick:()=>y(),className:"flex items-center gap-2",children:[(0,t.jsx)(U.A,{className:"h-4 w-4"}),"Check Again"]})})]})})]})}),(0,t.jsx)(R,{value:"summary",children:(0,t.jsxs)(f,{children:[(0,t.jsx)(g,{children:(0,t.jsxs)(p,{className:"flex items-center gap-2",children:[(0,t.jsx)(O.A,{className:"h-5 w-5"}),"AI-Generated Musical Analysis"]})}),(0,t.jsxs)(v,{children:[Y&&(0,t.jsx)(_,{variant:"destructive",className:"mb-4",children:(0,t.jsx)(D,{children:Y})}),q?(0,t.jsxs)("div",{className:"flex items-center justify-center p-8",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500 mr-3"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Generating AI summary..."})]}):V?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-6",children:(0,t.jsx)("div",{className:"text-gray-800",children:G(V)})}),(0,t.jsx)("div",{className:"flex justify-end pt-2",children:(0,t.jsxs)(u.$,{onClick:Z,variant:"outline",size:"sm",disabled:q,className:"flex items-center gap-2 hover:bg-gray-50",children:[(0,t.jsx)(U.A,{className:"h-4 w-4"})," Regenerate Summary"]})})]}):(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("div",{className:"text-gray-400 mb-4",children:(0,t.jsx)(O.A,{className:"h-16 w-16 mx-auto opacity-50"})}),(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No AI Summary Yet"}),(0,t.jsx)("p",{className:"text-gray-500 mb-6 max-w-md mx-auto",children:"Generate an AI-powered musical analysis and summary of this score to get insights about its style, structure, and characteristics."}),(0,t.jsxs)(u.$,{onClick:Z,className:"flex items-center gap-2 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700",disabled:q||!(null==b?void 0:null===(x=b.score)||void 0===x?void 0:x.id),children:[(0,t.jsx)(X.A,{className:"h-4 w-4"}),"Generate AI Summary"]})]})]})]})})]})]}):(0,t.jsxs)("div",{className:"space-y-6 p-4",children:[(0,t.jsxs)("h2",{className:"text-2xl font-bold text-orange-600 flex items-center gap-2",children:[(0,t.jsx)(z.A,{className:"h-6 w-6"})," Score Analysis Results"]}),(0,t.jsx)(f,{children:(0,t.jsx)(v,{className:"p-6 text-center",children:(0,t.jsx)("p",{className:"text-gray-500",children:"Upload or select a score to see analysis results."})})})]})}function W(){let[e,s]=(0,a.useState)(null),[r,l]=(0,a.useState)(null),[n,i]=(0,a.useState)(!1);return(0,t.jsx)("div",{className:"min-h-screen bg-orange-50 text-foreground font-main",children:(0,t.jsxs)("div",{className:"container mx-auto flex flex-col",children:[(0,t.jsxs)("header",{className:"mb-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-primary",children:"Score Insights"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Upload music scores to extract key musical elements and generate summaries."})]}),(0,t.jsx)("section",{className:"mb-6",children:(0,t.jsx)(x,{onUploadSuccess:(e,r)=>{s(e),l(r),i(!0)},isProcessing:n})}),(0,t.jsx)("section",{className:"grid grid-cols-1 md:grid-cols-1 gap-6 mb-8 w-full ".concat(n?"border-2 border-dashed":""),children:(0,t.jsx)(w,{scoreId:e,taskId:r,children:(0,t.jsx)(B,{onProcessingChange:i})})})]})})}},95272:(e,s,r)=>{Promise.resolve().then(r.bind(r,91540))}},e=>{var s=s=>e(e.s=s);e.O(0,[849,433,724,716,441,684,358],()=>s(95272)),_N_E=e.O()}]);